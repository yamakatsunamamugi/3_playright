# AI自動化実装ドキュメント

## 概要
このドキュメントでは、Googleスプレッドシートと連携してAIツールを自動操作するシステムの実装について説明します。

## 実装した主要機能

### 1. モデル情報の動的取得 (model_fetcher.py)

各AIサービスから最新のモデル情報を自動的に取得する機能を実装しました。

**主な特徴：**
- APIまたはWebUIから最新モデル一覧を取得
- キャッシュ機構により頻繁なアクセスを防止
- エラー時のフォールバック機能

**対応AIサービス：**
- ChatGPT (OpenAI)
- Claude (Anthropic)
- Gemini (Google)
- Genspark
- Google AI Studio

**使用例：**
```python
from src.ai_tools.model_fetcher import create_model_fetcher, ModelProvider

# ChatGPTのモデル情報を取得
fetcher = create_model_fetcher(ModelProvider.CHATGPT)
models = await fetcher.fetch_models()
settings = await fetcher.fetch_settings()
```

### 2. 動的GUI生成 (ai_config_widget.py拡張)

取得したモデル情報をGUIに動的に反映する機能を実装しました。

**主な機能：**
- モデル一覧の自動更新
- リフレッシュボタンによる手動更新
- 設定オプションの動的生成
- ツールチップによる説明表示

**実装詳細：**
```python
# AIConfigWidgetクラスの拡張
- _fetch_models_async(): 非同期でモデル情報を取得
- _update_models(): UIを更新
- _refresh_models(): 手動リフレッシュ機能
```

### 3. Chrome統合機能 (browser_manager.py拡張)

既存のChromeプロファイルを使用してログイン済みセッションを利用する機能を実装しました。

**主な機能：**
- Chromeプロファイルの自動検出
- ログイン済みセッションの再利用
- マルチプロファイル対応
- bot検出回避機能

**セキュリティ対策：**
- 一時ディレクトリにプロファイルをコピーして使用
- 元のプロファイルを保護
- 必要な認証情報のみコピー

## エラーハンドリング

### 1. ネットワークエラー対策
- 3回のリトライ機構
- 指数バックオフによる待機
- タイムアウト設定

### 2. フォールバック機構
- API/WebUI取得失敗時はハードコーディングされたデータを使用
- ユーザーへの通知とログ記録
- 部分的な失敗でも継続動作

### 3. ログ機能
- 詳細なデバッグログ
- エラーのスタックトレース
- 実行状況の可視化

## テスト方法

### 1. モデルフェッチャーのテスト
```bash
python test_model_fetcher.py
```
各AIサービスのモデル情報取得をテストします。

### 2. 統合テスト
```bash
python test_ai_automation.py
```
GUI、モデル取得、Chrome統合の全機能をテストします。

### 3. メインアプリケーションの実行
```bash
python main.py
```
完全な機能を持つアプリケーションを起動します。

## 今後の拡張予定

### 1. 設定オプションの動的取得（優先度：低）
- DeepThink等の高度な設定の自動検出
- AIサービス固有の設定項目の動的生成

### 2. 自動ログイン機能
- セキュアな認証情報管理
- 2要素認証への対応

### 3. エラーリカバリー機能の強化
- セッションタイムアウトの自動回復
- ネットワーク切断時の再接続

## トラブルシューティング

### Q: モデル情報が取得できない
A: 以下を確認してください：
1. インターネット接続
2. キャッシュディレクトリの権限
3. ログファイルのエラーメッセージ

### Q: Chromeプロファイルが見つからない
A: 以下のパスを確認してください：
- macOS: `~/Library/Application Support/Google/Chrome/`
- Windows: `%LOCALAPPDATA%\Google\Chrome\User Data\`
- Linux: `~/.config/google-chrome/`

### Q: AIサービスにアクセスできない
A: 以下を試してください：
1. 通常のChromeブラウザでログイン状態を確認
2. プロファイル選択が正しいか確認
3. セキュリティソフトの設定を確認

## セキュリティ上の注意

1. **認証情報の保護**
   - APIキーは環境変数で管理
   - パスワードはコードに記載しない

2. **プロファイルの取り扱い**
   - 一時コピーを使用して元データを保護
   - 使用後は確実にクリーンアップ

3. **ネットワーク通信**
   - HTTPS通信の使用
   - 証明書の検証

## まとめ

本実装により、以下の要件を満たすシステムを構築しました：

1. ✅ 各AIツールの最新モデルを自動取得
2. ✅ プルダウンで選択可能なUIの動的生成
3. ✅ 既存のChromeブラウザから開く機能
4. ⏳ DeepThinkなどの設定オプションの動的取得（今後実装予定）

システムは拡張性とメンテナンス性を考慮して設計されており、新しいAIサービスの追加も容易です。